<header class="top-menu">
    <div class="menu-left">
    </div>

    <div class="menu-right">
      <a href="/" (click)="logOut()">Izloguj se</a>
    </div>
  </header>

<div class="blurred">
    <div class="page-wrapper">

            <div class="users-wrapper">

            <!-- Postojeci korisnici -->
            <div class="users-card">
                <h2>Postojeƒái korisnici</h2>
                <div class="table-wrapper">
                    <table class="users-table">
                    <thead>
                        <tr>
                        <th>Korisniƒçko ime</th>
                        <th>Ime</th>
                        <th>Prezime</th>
                        <th>Pol</th>
                        <th>Adresa</th>
                        <th>Telefon</th>
                        <th>Mejl</th>
                        <th>Kartica</th>
                        <th>Tip</th>
                        <th>Status</th>
                        <th></th>
                        <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for(u of currUsers; track u.username){
                            <tr>
                                <td> {{u.username}} </td>
                                <td> <input type="text" [(ngModel)]="u.name" [style.width.ch]="u.name.length"> </td>
                                <td> <input type="text" [(ngModel)]="u.lastname" [style.width.ch]="u.lastname.length"> </td>
                                <td> {{u.gender}} </td>
                                <td> <input type="text" [(ngModel)]="u.address" [style.width.ch]="u.address.length"> </td>
                                <td> <input type="text" [(ngModel)]="u.phone" [style.width.ch]="u.phone.length"> </td>
                                <td> <input type="text" [(ngModel)]="u.mail" [style.width.ch]="u.mail.length"> </td>
                                <td> <input type="text" [(ngModel)]="u.card" [style.width.ch]="u.card.length"> </td>
                                <td> {{u.type}} </td>
                                <td> <span [ngClass]="{ 'status-odbijen': u.status === 'deaktiviran', 'status-aktivan': u.status === 'aktivan' }">{{u.status}}</span> </td>
                                <td><button class="btn primary small" (click)="updateUser(u)">Izmeni</button></td>
                                <td><button class="btn danger small" (click)="deactivateUser(u)" [ngClass]="{ 'btn-disabled': u.status === 'deaktiviran' }" [disabled]="u.status === 'deaktiviran'">Deaktiviraj</button></td>
                            </tr>
                        }
                    </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="users-wrapper">
        <!-- Zahtevi za registraciju -->
            <div class="users-card">
                <h2>Neobradjeni zahtevi za registraciju</h2>
                <div class="table-wrapper">
                    <table class="users-table">
                    <thead>
                        <tr>
                        <th>Korisniƒçko ime</th>
                        <th>Ime</th>
                        <th>Prezime</th>
                        <th>Pol</th>
                        <th>Adresa</th>
                        <th>Telefon</th>
                        <th>Mejl</th>
                        <th>Kartica</th>
                        <th>Tip</th>
                        <th>Status</th>
                        <th></th>
                        <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for(u of regReq; track u.username){
                            <tr>
                                <td>{{u.username}}</td>
                                <td>{{u.name}}</td>
                                <td>{{u.lastname}}</td>
                                <td>{{u.gender}}</td>
                                <td>{{u.address}}</td>
                                <td>{{u.phone}}</td>
                                <td>{{u.mail}}</td>
                                <td>{{u.card}}</td>
                                <td>{{u.type}}</td>
                                <td> 
                                    <span [ngClass]="{ 'status-odbijen': u.status === 'odbijen', 'status-cekanje': u.status === 'neobradjen' }">{{u.status}}</span>
                                </td>
                                <td>
                                    <button class="btn primary small" [ngClass]="{ 'btn-disabled': u.status === 'odbijen' }" 
                                    (click)="acceptUser(u.username)" >Prihvati</button>
                                </td>
                                <td>
                                    <button class="btn danger small" [ngClass]="{ 'btn-disabled': u.status === 'odbijen' }"
                                    (click)="declineUser(u.username)">Odbij</button>
                                </td>
                            </tr>
                        }
                    </tbody>
                    </table>
                </div>
            </div>
        </div>





        <div class="page-header">
            <h1>Sve vikendice</h1>
        </div>

        <!-- LISTA VIKENDICA -->
            <div class="cottage-wrapper">
            <div class="cottages-list">
                <div *ngFor="let c of allCottages" class="cottage-card" [ngClass]="{ 'critical': criticalMap[c.id] }">
                    <div class="cottage-media slider">
                    <button class="slider-btn prev" (click)="prevPicture(c)" *ngIf="c.pictures.length > 1">‚ùÆ</button>

                    <img [src]="'http://localhost:8080/img/' + getActivePicture(c)" alt="{{ c.name }}">

                    <button class="slider-btn next" (click)="nextPicture(c)" *ngIf="c.pictures.length > 1">‚ùØ</button>
                    </div>


                <div class="cottage-body">
                    <h2 class="cottage-title">{{ c.name }}</h2>
                    <p class="cottage-location">{{ c.location }}</p>

                    <div class="cottage-services">{{ c.services }}</div>

                    <div class="cottage-rating">
                        <strong>Ocena:</strong>  <span class="rating-number">{{ c.rating | number:'1.1-2' }}</span>
                        <span class="rating-stars">
                            <ng-container *ngFor="let star of getStars(c.rating); let i = index">
                                <img [src]="star ? 'img/star-full.png' : 'img/star-empty.png'" alt="star" />
                            </ng-container>
                        </span>
                    </div>

                    <div class="cottage-prices">
                    <div><strong>Letnja cena:</strong> {{ c.price_summer | number:'1.2-2' }} RSD</div>
                    <div><strong>Zimska cena:</strong> {{ c.price_winter | number:'1.2-2' }} RSD</div>
                    <div><strong>Cena radnim danom:</strong> {{ c.price_weekday ? (c.price_weekday | number:'1.2-2') + ' RSD' : '-' }}</div>
                    <div><strong>Cena vikendom:</strong> {{ c.price_weekend ? (c.price_weekend | number:'1.2-2') + ' RSD' : '-' }}</div>
                    </div>

                    <div class="cottage-meta">
                    <span class="meta-item">üìû {{ c.phone || '-' }}</span>
                    </div>
                    <span [ngClass]="{ 'status-odbijen': c.status === 'blokirana', 'status-aktivan': c.status === 'aktivna' }">{{c.status}}</span>

                    <div class="cottage-actions" *ngIf="criticalMap[c.id]">
                        <button class="btn danger" (click)="blockCottage(c.id)"
                        [ngClass]="{ 'btn-disabled': c.status === 'blokirana' }"  [disabled]="c.status === 'blokirana'">Privremeno blokiraj</button>
                    </div>
                </div>
                </div>
            </div>
        </div>

    </div>
</div>